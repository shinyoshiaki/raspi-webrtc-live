<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Client</title>
  </head>
  <body>
    <div></div>
    <script>
      (async () => {
        const socket = new WebSocket("ws://localhost:8888");
        await new Promise((r) => (socket.onopen = r));

        const offer = await new Promise(
          (r) => (socket.onmessage = (ev) => r(JSON.parse(ev.data)))
        );

        const peer = new RTCPeerConnection({
          iceServers: [{ urls: "stun:stun.l.google.com:19302" }],
        });
        peer.onicecandidate = ({ candidate }) => {
          if (candidate) {
            socket.send(JSON.stringify(candidate));
          }
        };
        peer.ontrack = async (e) => {
          const video = document.createElement("video");
          document.body.appendChild(video);
          console.log(e);
          video.srcObject = e.streams[0];
          await video.play();
        };

        await peer.setRemoteDescription(offer);
        await peer.setLocalDescription(await peer.createAnswer());
        socket.send(JSON.stringify(peer.localDescription));
      })();
    </script>
  </body>
</html>
